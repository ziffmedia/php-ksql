SET 'auto.offset.reset'='earliest';

CREATE STREAM users1 (
    userid VARCHAR,
    gender VARCHAR
) WITH (
    kafka_topic='users1', value_format='json'
);

CREATE STREAM users2 (
    userid VARCHAR,
    gender VARCHAR
) WITH (
    kafka_topic='users2', value_format='json'
);

CREATE TABLE users1_table AS
SELECT userid, LATEST_BY_OFFSET(gender) gender
FROM users1
GROUP BY userid
EMIT CHANGES;

CREATE TABLE users2_table AS
SELECT userid, LATEST_BY_OFFSET(gender) gender
FROM users2
GROUP BY userid
EMIT CHANGES;


curl --http1.1 \
     -X "POST" "http://localhost:8088/query" \
     -H "Accept: application/vnd.ksql.v1+json" \
     -d $'{
  "ksql": "SELECT * FROM users1_table;",
  "streamsProperties": {}
}'


curl -X "POST" "http://localhost:8088/query-stream" \
     -d $'{
  "sql": "SELECT * FROM users1_table EMIT CHANGES;",
  "properties": {}
}'